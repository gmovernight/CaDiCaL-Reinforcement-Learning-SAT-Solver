#########################################################################################################################################
 	       PROJECT ENVIRONMENT SETUP
*****************************************************************************************************************************************

#########################################################################################################################################
CREATE NEW PYTHON ENVIRONMENT

python3 -m venv .venv

*****************************************************************************************************************************************

#########################################################################################################################################
ACTIVATE PYTHON ENVIRONMENT

source .venv/bin/activate

*****************************************************************************************************************************************

#########################################################################################################################################
INSTALL DEPENDENCIES

pip install -r requirements.txt

*****************************************************************************************************************************************

#########################################################################################################################################
DELETE ZONE IDENTIFIER FILES (OPTIONAL)

find . -type f -name '*Zone.Identifier*' -delete

*****************************************************************************************************************************************

#########################################################################################################################################
ZIP PROJECT (OPTIONAL)

rm -f ../rlsat_codex.zip

zip -r ../rlsat_codex.zip bridge cadical cfg data env logs results scripts tests rl .gitignore README.md requirements.txt

*****************************************************************************************************************************************

#########################################################################################################################################
BUILD CADICAL

cmake -S cadical -B cadical/build -DCMAKE_BUILD_TYPE=Release -DCMAKE_POSITION_INDEPENDENT_CODE=ON

cmake --build cadical/build -j

*****************************************************************************************************************************************

#########################################################################################################################################
RUN CADICAL DEFAULT ON A SAT INSTANCE (OPTIONAL)

./cadical/build/cadical_app data/instances/val/flat50-115/flat50-123.cnf

*****************************************************************************************************************************************

#########################################################################################################################################
BUILD PYBIND BRIDGE

cmake -S bridge -B bridge/build -DCMAKE_BUILD_TYPE=Release -DPython3_EXECUTABLE="$(python3 -c 'import sys; print(sys.executable)')"

cmake --build bridge/build -j

*****************************************************************************************************************************************

#########################################################################################################################################
RUN PYTEST (OPTIONAL)

pytest -q

*****************************************************************************************************************************************

#########################################################################################################################################
 		      TRAINING
*****************************************************************************************************************************************

#########################################################################################################################################
STAGE A (Train on SAT‑only uf (f50‑218))
*****************************************************************************************************************************************

#########################################################################################################################################
SEED 0 CONFIG

python - <<'PY'
import yaml
cfg=yaml.safe_load(open('cfg/a2c.yaml'))
cfg['seed']=0
open('cfg/seed0.yaml','w').write(yaml.safe_dump(cfg))
PY

*****************************************************************************************************************************************

#########################################################################################################################################
TRAIN A2C POLICY

python scripts/train_a2c.py --cfg cfg/seed0.yaml --split train --family 'f50-218/uf' --max-updates 50000 --logdir logs/gae_lbd_stageA_seed0

*****************************************************************************************************************************************

#########################################################################################################################################
SUMMARIZE + CURVES

python scripts/save_training_summary.py logs/gae_lbd_stageA_seed0/train.jsonl --out logs/gae_lbd_stageA_seed0/summary.json

python scripts/plot_training_curves.py logs/gae_lbd_stageA_seed0/train.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
STAGE B (Train on mixed SAT/UNSAT (f50‑218)
(warm‑start from Stage A))
*****************************************************************************************************************************************

#########################################################################################################################################
TRAIN A2C POLICY

python scripts/train_a2c.py --cfg cfg/seed0.yaml --split train --family f50-218 --max-updates 50000 --logdir logs/gae_lbd_stageB_seed0 --
init-ckpt logs/gae_lbd_stageA_seed0/ckpt.pt

*****************************************************************************************************************************************

#########################################################################################################################################
SUMMARIZE + CURVES

python scripts/save_training_summary.py logs/gae_lbd_stageB_seed0/train.jsonl --out logs/gae_lbd_stageB_seed0/summary.json

python scripts/plot_training_curves.py logs/gae_lbd_stageB_seed0/train.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
STAGE C — Train on mixed SAT/UNSAT (f100‑430, longer horizon)
(warm‑start from Stage B)
*****************************************************************************************************************************************

#########################################################################################################################################
SEED 0 CONFIG WITH LONGER ROLLOUT

python - <<'PY'
import yaml
cfg=yaml.safe_load(open('cfg/a2c.yaml'))
cfg['seed']=0
cfg['rollout_T']=64
open('cfg/seed0_t64.yaml','w').write(yaml.safe_dump(cfg))
PY

*****************************************************************************************************************************************

#########################################################################################################################################
TRAIN A2C POLICY

python scripts/train_a2c.py --cfg cfg/seed0_t64.yaml --split train --family f100-430 --max-updates 50000 --logdir logs/gae_lbd_stageC_seed0
--init-ckpt logs/gae_lbd_stageB_seed0/ckpt.pt

*****************************************************************************************************************************************

#########################################################################################################################################
SUMMARIZE + CURVES

python scripts/save_training_summary.py logs/gae_lbd_stageC_seed0/train.jsonl --out logs/gae_lbd_stageC_seed0/summary.json

python scripts/plot_training_curves.py logs/gae_lbd_stageC_seed0/train.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
 	   BASELINES (val, 60s, K=16, M=8)
*****************************************************************************************************************************************

#########################################################################################################################################
f50‑218

python scripts/run_baselines.py --split val --family f50-218 --timeout_s 60 --K 16 --M 8 --out results/f50-218/val-baselines-60s.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
f100‑430

python scripts/run_baselines.py --split val --family f100-430 --timeout_s 60 --K 16 --M 8 --out results/f100-430/val-baselines-60s.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
flat50‑115

python scripts/run_baselines.py --split val --family flat50-115 --timeout_s 60 --K 16 --M 8 --out results/flat50-115/val-baselines-60s.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
 	  A2C Evaluation (val, 60s, K=16, M=8)
*****************************************************************************************************************************************

#########################################################################################################################################
f50‑218 (STAGE B CHECKPOINT)

python scripts/eval_a2c.py --split val --family f50-218 --ckpt logs/gae_lbd_stageB_seed0/ckpt.pt --timeout_s 60 --K 16 --M 8 --mode greedy
 --out results/f50-218/val-a2c-60s.greedy.gae_lbd.jsonl

python scripts/eval_a2c.py --split val --family f50-218 --ckpt logs/gae_lbd_stageB_seed0/ckpt.pt --timeout_s 60 --K 16 --M 8 --mode sample
 --out results/f50-218/val-a2c-60s.sample.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
f100‑430 (STAGE C CHECKPOINT)

python scripts/eval_a2c.py --split val --family f100-430 --ckpt logs/gae_lbd_stageC_seed0/ckpt.pt --timeout_s 60 --K 16 --M 8 --mode greedy
 --out results/f100-430/val-a2c-60s.greedy.gae_lbd.jsonl

python scripts/eval_a2c.py --split val --family f100-430 --ckpt logs/gae_lbd_stageC_seed0/ckpt.pt --timeout_s 60 --K 16 --M 8 --mode sample
 --out results/f100-430/val-a2c-60s.sample.gae_lbd.jsonl
*****************************************************************************************************************************************

#########################################################################################################################################
flat50‑115 (GENERALIZATION; STAGE B CHECKPOINT)

python scripts/eval_a2c.py --split val --family flat50-115 --ckpt logs/gae_lbd_stageB_seed0/ckpt.pt --timeout_s 60 --K 16 --M 8 --mode greedy
 --out results/flat50-115/val-a2c-60s.greedy.gae_lbd.jsonl

python scripts/eval_a2c.py --split val --family flat50-115 --ckpt logs/gae_lbd_stageB_seed0/ckpt.pt --timeout_s 60 --K 16 --M 8 --mode sample
 --out results/flat50-115/val-a2c-60s.sample.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
 	   BASELINES (test, 60s, K=16, M=8)
*****************************************************************************************************************************************

#########################################################################################################################################
f50‑218

python scripts/run_baselines.py --split test --family f50-218 --timeout_s 60 --K 16 --M 8 --out results/f50-218/test-baselines-60s.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
f100‑430

python scripts/run_baselines.py --split test --family f100-430 --timeout_s 60 --K 16 --M 8 --out results/f100-430/test-baselines-60s.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
flat50‑115

python scripts/run_baselines.py --split test --family flat50-115 --timeout_s 60 --K 16 --M 8 --out results/flat50-115/test-baselines-60s.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
 	  A2C Evaluation (test, 60s, K=16, M=8)
*****************************************************************************************************************************************

#########################################################################################################################################
f50‑218 (STAGE B CHECKPOINT)

python scripts/eval_a2c.py --split test --family f50-218 --ckpt logs/gae_lbd_stageB_seed0/ckpt.pt --timeout_s 60 --K 16 --M 8 --mode greedy --out results/f50-218/test-a2c-60s.greedy.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
f100‑430 (STAGE C CHECKPOINT)

python scripts/eval_a2c.py --split test --family f100-430 --ckpt logs/gae_lbd_stageC_seed0/ckpt.pt --timeout_s 60 --K 16 --M 8 --mode greedy --out results/f100-430/test-a2c-60s.greedy.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
flat50‑115 (GENERALIZATION; STAGE B CHECKPOINT)

python scripts/eval_a2c.py --split test --family flat50-115 --ckpt logs/gae_lbd_stageB_seed0/ckpt.pt --timeout_s 60 --K 16 --M 8 --mode greedy --out results/flat50-115/test-a2c-60s.greedy.gae_lbd.jsonl

*****************************************************************************************************************************************

#########################################################################################################################################
 	   COMPARISON BARS (SOLVED + PAR‑2)
*****************************************************************************************************************************************

#########################################################################################################################################
f50‑218

python scripts/plot_eval_vs_baselines.py --baselines results/f50-218/test-baselines-60s.gae_lbd.jsonl --eval results/f50-218/test-a2c-60s.greedy.gae_lbd.jsonl --out results/f50-218/test-bars.png --title "f50-218 TEST (60s)"

*****************************************************************************************************************************************

#########################################################################################################################################
f100‑430

python scripts/plot_eval_vs_baselines.py --baselines results/f100-430/test-baselines-60s.gae_lbd.jsonl --eval results/f100-430/test-a2c-60s.greedy.gae_lbd.jsonl --out results/f100-430/test-bars.png --title "f100-430 TEST (60s)"

*****************************************************************************************************************************************

#########################################################################################################################################
flat50‑115

python scripts/plot_eval_vs_baselines.py --baselines results/flat50-115/test-baselines-60s.gae_lbd.jsonl --eval results/flat50-115/test-a2c-60s.greedy.gae_lbd.jsonl --out results/flat50-115/test-bars.png --title "flat50-115 TEST (60s)"

*****************************************************************************************************************************************

#########################################################################################################################################
 	   CACTUS PLOTS (CUMULATIVE SOLVED)
*****************************************************************************************************************************************

#########################################################################################################################################
f50‑218

python scripts/plot_cactus.py --in results/f50-218/test-baselines-60s.gae_lbd.jsonl results/f50-218/test-a2c-60s.greedy.gae_lbd.jsonl --out results/f50-218/test-cactus.png --title "f50-218 TEST (60s) cactus" --policy clip

*****************************************************************************************************************************************

#########################################################################################################################################
f100‑430

python scripts/plot_cactus.py --in results/f100-430/test-baselines-60s.gae_lbd.jsonl results/f100-430/test-a2c-60s.greedy.gae_lbd.jsonl --out results/f100-430/test-cactus.png --title "f100-430 TEST (60s) cactus" --policy clip

*****************************************************************************************************************************************

#########################################################################################################################################
flat50‑115

python scripts/plot_cactus.py --in results/flat50-115/test-baselines-60s.gae_lbd.jsonl results/flat50-115/test-a2c-60s.greedy.gae_lbd.jsonl --out results/flat50-115/test-cactus.png --title "flat50-115 TEST (60s) cactus" --policy clip

*****************************************************************************************************************************************

#########################################################################################################################################
 	        TABLES (CSV + CONSOLE)
*****************************************************************************************************************************************

#########################################################################################################################################
f50‑218

python scripts/make_tables.py --in results/f50-218/test-baselines-60s.gae_lbd.jsonl results/f50-218/test-a2c-60s.greedy.gae_lbd.jsonl --out results/f50-218/test-table.csv

*****************************************************************************************************************************************

#########################################################################################################################################
f100‑430

python scripts/make_tables.py --in results/f100-430/test-baselines-60s.gae_lbd.jsonl results/f100-430/test-a2c-60s.greedy.gae_lbd.jsonl --out results/f100-430/test-table.csv

*****************************************************************************************************************************************

#########################################################################################################################################
flat50‑115

python scripts/make_tables.py --in results/flat50-115/test-baselines-60s.gae_lbd.jsonl results/flat50-115/test-a2c-60s.greedy.gae_lbd.jsonl --out results/flat50-115/test-table.csv

*****************************************************************************************************************************************









